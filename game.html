<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heavenis - Tetris</title>
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:radial-gradient(circle at top,#0f2027,#203a43,#2c5364);color:white;overflow:hidden;display:flex;flex-direction:column;align-items:center;}
header{background:rgba(0,0,0,0.7);padding:10px 0;display:flex;justify-content:center;gap:15px;width:100%;position:sticky;top:0;z-index:10;}
header a{text-decoration:none;color:white;font-weight:bold;padding:8px 15px;border-radius:10px;transition:0.3s;}
header a:hover{background:linear-gradient(45deg,#00ffcc,#3333ff);}
.game-container{display:flex;flex-direction:column;align-items:center;margin-top:30px;}
#gameIntro{text-align:center;}
#gameIntro h1{font-size:3em;margin-bottom:20px;background:linear-gradient(45deg,#00ffcc,#3333ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.menu-btn{background:linear-gradient(45deg,#00ffcc,#3333ff);border:none;padding:12px 30px;border-radius:12px;color:white;font-size:1.2em;cursor:pointer;transition:0.3s;margin-top:15px;}
.menu-btn:hover{transform:scale(1.05);box-shadow:0 0 25px #00ffcc;}
#gameMenu{display:none;flex-direction:column;align-items:center;margin-top:20px;gap:15px;background:rgba(0,0,0,0.6);padding:20px;border-radius:15px;}
label{font-size:1.2em;margin-bottom:5px;}
select{padding:5px 10px;font-size:1em;border-radius:10px;border:none;}
#tetrisGame{display:none;position:relative;margin-top:20px;}
canvas{background:#111;display:block;border:2px solid #00ffcc;}
</style>
</head>
<body>

<header>
  <a href="acceuil.html">Accueil</a>
  <a href="apropos.html">À propos</a>
  <a href="histoire.html">Histoire</a>
  <a href="contact.html">Contact</a>
  <a href="serveur.html">Serveur</a>
  <a href="game.html" style="background:linear-gradient(45deg,#00ffcc,#3333ff);">Game</a>
</header>

<div class="game-container">
  <div id="gameIntro">
    <h1>Tetris Heavenis</h1>
    <button class="menu-btn" id="playBtn">Jouer</button>
  </div>

  <div id="gameMenu">
    <label>Niveau :</label>
    <select id="levelSelect">
      <option value="0">Très facile</option>
      <option value="1">Facile</option>
      <option value="2" selected>Normal</option>
      <option value="3">Intermédiaire</option>
      <option value="4">Amateur</option>
      <option value="5">Semi-pro</option>
      <option value="6">Pro</option>
      <option value="7">Champion</option>
      <option value="8">Légendaire</option>
    </select>
    <button class="menu-btn" id="startGameBtn">Commencer</button>
  </div>

  <div id="tetrisGame">
    <canvas id="canvasTetris" width="400" height="600"></canvas>
  </div>
</div>

<script>
const playBtn=document.getElementById('playBtn');
const gameIntro=document.getElementById('gameIntro');
const gameMenu=document.getElementById('gameMenu');
const tetrisGame=document.getElementById('tetrisGame');
const canvas=document.getElementById('canvasTetris');
const ctx=canvas.getContext('2d');

playBtn.addEventListener('click',()=>{
  if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();}
  gameIntro.style.display='none';
  gameMenu.style.display='flex';
});

const levels=[0.5,1,1.5,2,2.5,3,3.5,4,5];
let currentLevel=2;

document.getElementById('startGameBtn').addEventListener('click',()=>{
  currentLevel=parseInt(document.getElementById('levelSelect').value);
  gameMenu.style.display='none';
  tetrisGame.style.display='block';
  startTetris();
});

// --- Tetris Variables ---
const COLS=10, ROWS=20, BLOCK=30;
let board=[];
for(let r=0;r<ROWS;r++){board[r]=Array(COLS).fill(0);}
const shapes=[[[1,1,1],[0,1,0]],[[0,2,2],[2,2,0]],[[3,3,0],[0,3,3]],[[4,4],[4,4]],[[5,5,5,5]],[[6,6,6],[6,0,0]],[[7,7,7],[0,0,7]]];
const colors=["#00ffcc","#ff00cc","#3333ff","#ffcc00","#00ff33","#cc00ff","#ff5500"];
let currentPiece,pieceX,pieceY,currentColor,yOffset=0,lastTime=0,dropSpeed;

// --- Fonctions ---
function randomColor(){return colors[Math.floor(Math.random()*colors.length)];}

function newPiece(){
  currentPiece=shapes[Math.floor(Math.random()*shapes.length)];
  currentColor=randomColor();
  pieceX=Math.floor(COLS/2)-Math.floor(currentPiece[0].length/2);
  pieceY=0;
  yOffset=0;
}

function drawBlock(x,y,color){
  ctx.fillStyle=color;
  ctx.fillRect(x*BLOCK,y*BLOCK,BLOCK,BLOCK);
  ctx.strokeStyle="#111";
  ctx.strokeRect(x*BLOCK,y*BLOCK,BLOCK,BLOCK);
}

function drawBoard(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(board[r][c]) drawBlock(c,r,board[r][c]);
    }
  }
  for(let r=0;r<currentPiece.length;r++){
    for(let c=0;c<currentPiece[r].length;c++){
      if(currentPiece[r][c]){
        drawBlock(c+pieceX,r+pieceY+yOffset,currentColor);
      }
    }
  }
}

function collide(offsetX=0,offsetY=0){
  for(let r=0;r<currentPiece.length;r++){
    for(let c=0;c<currentPiece[r].length;c++){
      if(currentPiece[r][c]){
        let newX=pieceX+c+offsetX;
        let newY=Math.floor(pieceY+offsetY)+r;
        if(newY>=ROWS || newX<0 || newX>COLS-1 || board[newY][newX]) return true;
      }
    }
  }
  return false;
}

function merge(){
  for(let r=0;r<currentPiece.length;r++){
    for(let c=0;c<currentPiece[r].length;c++){
      if(currentPiece[r][c]){
        board[pieceY+r][pieceX+c]=currentColor;
      }
    }
  }
}

function rotate(){
  const N=currentPiece.length;
  let newPieceArr=Array.from({length:N},()=>Array(N).fill(0));
  for(let r=0;r<N;r++){for(let c=0;c<N;c++){newPieceArr[c][N-1-r]=currentPiece[r][c];}}
  let prevPiece=currentPiece;
  currentPiece=newPieceArr;
  if(collide()) currentPiece=prevPiece;
}

// --- Controls ---
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowLeft'){pieceX--; if(collide()) pieceX++;}
  if(e.key==='ArrowRight'){pieceX++; if(collide()) pieceX--;}
  if(e.key==='ArrowDown'){dropSpeed=5;}
  if(e.key==='ArrowUp'){rotate();}
});

function drop(){
  merge();
  clearLines();
  newPiece();
  if(collide()){alert('Game Over'); location.reload();}
}

function clearLines(){
  for(let r=ROWS-1;r>=0;r--){
    if(board[r].every(cell=>cell)){board.splice(r,1); board.unshift(Array(COLS).fill(0)); r++;}
  }
}

function update(time){
  if(!lastTime) lastTime=time;
  const delta=time-lastTime;
  lastTime=time;
  yOffset+=delta*0.001*levels[currentLevel]*dropSpeed;
  if(yOffset>=1){
    pieceY+=Math.floor(yOffset);
    yOffset%=1;
    if(collide()){pieceY--; drop(); dropSpeed=1;}
  }
  drawBoard();
  requestAnimationFrame(update);
}

function startTetris(){
  newPiece();
  dropSpeed=1;
  requestAnimationFrame(update);
}
</script>
</body>
</html>